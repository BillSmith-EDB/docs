---
title: Statement Level Rollback
originalFilePath: txnrollback.md

---

In PostgreSQL, any ERROR within a transaction will rollback all actions
by that transaction. This behavior is different to other DBMS, such
as Oracle and SQLServer, where an ERROR causes rollback of only the last
statement. This difference in transaction handling semantics doesn't
cause a problem in all cases, but it does make code migration more
difficult in some cases.

One workaround is to manually introduce a SAVEPOINT, internally known as
subtransactions into the application code. This is time-consuming and
difficult to test. SAVEPOINTs are additional statements and so increase
transaction latency. Given the overhead of additional development work
and slower performance this approach is not viable in most cases.

The purpose of th Statement Level Rollback feature is to provide an
optional mode to choose whether to allow rollback of the whole transaction
or just the current statement. No manual recoding is required, though
there is some additional overhead, just lower than SAVEPOINTs.

The new `transaction_rollback_scope` option has two possible values:
`transaction` (which gives standard Postgres behavior, where each error
aborts the whole transaction) and `statement`. If the `statement` value
is selected, then a subtransaction is opened just before each SQL
command; if the command is successful, the subtransaction is *committed*
(see below); if the command raises an error, the subtransaction is
rolled back, and the parent transaction can continue normally. The
effect is that an error during execution of one statement affects only
that statement, and not the status of the transaction as a whole.

Note that committing a subtransaction only assigns the
resources it holds to its parent transaction (which may be the toplevel
transaction, or some other subtransaction if there are user-defined
savepoints involved) - so this is not an "autonomous transaction".
Rolling back a subtransaction releases all the
resources it holds, such as any locks it may have acquired.

This parameter can be set as a user-level property

```sql
ALTER USER somebody SET transaction_rollback_scope TO statement;
```

or a connection option

```sh-session
PGOPTIONS="-c transaction_rollback_scope=statement" psql <other options>
```

When using this feature with PL/pgSQL it is possible to set the mode
for execution for specific functions or procedures like this

```sql
ALTER FUNCTION myfunc SET transaction_rollback_scope TO statement;
```
