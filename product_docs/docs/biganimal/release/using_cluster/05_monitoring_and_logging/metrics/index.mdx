#### Group `cnp_backends`

Backend counts from `pg_stat_activity` aggregated by the listed label
dimensions. Useful for identifying busy applications, excessive idle
backends, etc.

Derived from the `pg_stat_activity` view.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_backends_state` | GAUGE | State of the backend (pg\_stat\_activity.state) mapped to integer enum. active = 1, idle = 2, idle in transaction = 3, idle in transaction (aborted) = 4, fastpath function call = 5, disabled = 6, and -1 = other/unrecognised |
| `cnp_backends_n_backends` | GAUGE | Number of backends in this group |
| `cnp_backends_max_tx_duration_seconds` | GAUGE | Maximum duration of a transaction in seconds in this group |
| `cnp_backends_max_backend_xmin_age` | GAUGE | Maximum duration of a transaction in seconds in this group |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `datname` | Name of the database for this group of backends |
| `usename` | Name of the user in this group of backends |
| `application_name` | Name of the application for this group of backends |

#### Group `cnp_backends_waiting`

Postgres-instance-level aggregate information on backends that are blocked
waiting for locks. Does not count I/O waits or other reasons backends might
wait or be blocked.

Derived from the `pg_locks` view.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_backends_waiting_total` | GAUGE | Total number of backends that are currently waiting on other queries |

#### Group `cnp_pg_database`

Per-database metrics for each database in the postgres instance.
Includes per-database vacuum progress information.

Derived from the `pg_database` catalog.

See also `cnp_pg_stat_database`.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_database_size_bytes` | GAUGE | Disk space used by the database |
| `cnp_pg_database_xid_age` | GAUGE | Number of transactions from the frozen XID to the current one |
| `cnp_pg_database_mxid_age` | GAUGE | Number of multiple transactions (Multixact) from the frozen XID to the current one |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `datname` | Name of the database |

#### Group `cnp_pg_postmaster`

Data on the postgres instance's managing "postmaster" process.

Derived from the `pg_postmaster_start_time()` function.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_postmaster_start_time` | GAUGE | Time at which postgres started (based on epoch) |

#### Group `cnp_pg_replication`

Physical replication details for a standby postgres instance
as captured from the standby itself.

Derived from the `pg_last_xact_replay_timestamp()` function.

Only relevant on standby servers.

See also `cnp_pg_stat_replication`, `cnp_pg_replication_slots`.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_replication_lag` | GAUGE | Replication lag behind primary in seconds |
| `cnp_pg_replication_in_recovery` | GAUGE | Whether the instance is in recovery |

#### Group `cnp_pg_replication_slots`

Details about replication slots on a postgres instance. In most
configurations only the primary server will have active replication clients,
but other nodes may still have replication slots.

Note that logical replication slots are specific to a database, whereas
physical replication slots will have an empty "database" label as they
apply to the postgres instance as a whole.

Derived from the `pg_replication_slots` view.

See also `cnp_pg_stat_replication`, `cnp_pg_replication`.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_replication_slots_active` | GAUGE | Flag indicating if the slot is active |
| `cnp_pg_replication_slots_pg_wal_lsn_diff` | GAUGE | Replication lag in bytes |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `slot_name` | Name of the replication slot |
| `database` | Name of the database |

#### Group `cnp_pg_stat_archiver`

Progress information about WAL archiving. Only the currently active primary
server will generally be performing WAL archiving.

WAL archiving is important for backup and restore. If WAL archiving is
delayed or failing for too long, the point-in-time recovery backups for
a postgres cluster will not be up to date. This has disaster recovery
implications and can potentially also affect failover.

Occasional WAL archiving failures are normal, but a growing delay in the time
since the last successful WAL archiving operation should be taken seriously.

Metrics in this section are reset when a postgres stats reset is issued
on the db server.

Derived from the `pg_stat_archiver` view.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_stat_archiver_archived_count` | COUNTER | Number of WAL files that have been successfully archived |
| `cnp_pg_stat_archiver_failed_count` | COUNTER | Number of failed attempts for archiving WAL files |
| `cnp_pg_stat_archiver_seconds_since_last_archival` | GAUGE | Seconds since the last successful archival operation |
| `cnp_pg_stat_archiver_seconds_since_last_failure` | GAUGE | Seconds since the last failed archival operation |
| `cnp_pg_stat_archiver_last_archived_time` | GAUGE | Epoch of the last time WAL archiving succeeded |
| `cnp_pg_stat_archiver_last_failed_time` | GAUGE | Epoch of the last time WAL archiving failed |
| `cnp_pg_stat_archiver_last_archived_wal_start_lsn` | GAUGE | Archived WAL start LSN |
| `cnp_pg_stat_archiver_last_failed_wal_start_lsn` | GAUGE | Last failed WAL LSN |
| `cnp_pg_stat_archiver_stats_reset_time` | GAUGE | Time at which these statistics were last reset |

#### Group `cnp_pg_stat_bgwriter`

Stats for the postgres background writer and checkpointer processes, which
are instance-wide and shared across all databases in a postgres instance.

Very long delays between checkpoints on a busy system will increase the time
taken for it to return to read/write availability if crash recovery is
required. Excessively frequent checkpoints can increase I/O load and the size
of the WAL stream for backup and replication.

The postgres documentation discusses checkpoints, dirty writeback, and
checkpoint tuning in detail.

Metrics in this section are reset when a postgres stats reset is issued
on the db server.

Derived from the `pg_stat_bgwriter` catalog.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_stat_bgwriter_checkpoints_timed` | COUNTER | Number of scheduled checkpoints that have been performed |
| `cnp_pg_stat_bgwriter_checkpoints_req` | COUNTER | Number of requested checkpoints that have been performed |
| `cnp_pg_stat_bgwriter_checkpoint_write_time` | COUNTER | Total amount of time that has been spent in the portion of checkpoint processing where files are written to disk, in milliseconds |
| `cnp_pg_stat_bgwriter_checkpoint_sync_time` | COUNTER | Total amount of time that has been spent in the portion of checkpoint processing where files are synchronized to disk, in milliseconds |
| `cnp_pg_stat_bgwriter_buffers_checkpoint` | COUNTER | Number of buffers written during checkpoints |
| `cnp_pg_stat_bgwriter_buffers_clean` | COUNTER | Number of buffers written by the background writer |
| `cnp_pg_stat_bgwriter_maxwritten_clean` | COUNTER | Number of times the background writer stopped a cleaning scan because it had written too many buffers |
| `cnp_pg_stat_bgwriter_buffers_backend` | COUNTER | Number of buffers written directly by a backend |
| `cnp_pg_stat_bgwriter_buffers_backend_fsync` | COUNTER | Number of times a backend had to execute its own fsync call (normally the background writer handles those even when the backend does its own write) |
| `cnp_pg_stat_bgwriter_buffers_alloc` | COUNTER | Number of buffers allocated |

#### Group `cnp_pg_stat_database`

This metrics group directly exposes the summary data postgres collects in its
own `pg_stat_database` view. It contains statistical counters maintained by
postgres itself for database activity.

Metrics in this section are reset when a postgres stats reset is issued
on the db server.

Derived from the `pg_stat_database` catalog.

See also `cnp_pg_database`.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_stat_database_xact_commit` | COUNTER | Number of transactions in this database that have been committed |
| `cnp_pg_stat_database_xact_rollback` | COUNTER | Number of transactions in this database that have been rolled back |
| `cnp_pg_stat_database_blks_read` | COUNTER | Number of disk blocks read in this database |
| `cnp_pg_stat_database_blks_hit` | COUNTER | Number of times disk blocks were found already in the buffer cache, so that a read was not necessary (this only includes hits in the PostgreSQL buffer cache, not the operating system's file system cache) |
| `cnp_pg_stat_database_tup_returned` | COUNTER | Number of rows returned by queries in this database |
| `cnp_pg_stat_database_tup_fetched` | COUNTER | Number of rows fetched by queries in this database |
| `cnp_pg_stat_database_tup_inserted` | COUNTER | Number of rows inserted by queries in this database |
| `cnp_pg_stat_database_tup_updated` | COUNTER | Number of rows updated by queries in this database |
| `cnp_pg_stat_database_tup_deleted` | COUNTER | Number of rows deleted by queries in this database |
| `cnp_pg_stat_database_conflicts` | COUNTER | Number of queries canceled due to conflicts with recovery in this database |
| `cnp_pg_stat_database_temp_files` | COUNTER | Number of temporary files created by queries in this database |
| `cnp_pg_stat_database_temp_bytes` | COUNTER | Total amount of data written to temporary files by queries in this database |
| `cnp_pg_stat_database_deadlocks` | COUNTER | Number of deadlocks detected in this database |
| `cnp_pg_stat_database_blk_read_time` | COUNTER | Time spent reading data file blocks by backends in this database, in milliseconds |
| `cnp_pg_stat_database_blk_write_time` | COUNTER | Time spent writing data file blocks by backends in this database, in milliseconds |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `datname` | Name of this database |

#### Group `cnp_pg_stat_database_conflicts`

These metrics provide information on conflicts between queries on a standby
and the standby's replay of the change-stream from the primary. These are
called recovery conflicts.

These metrics are unrelated to "INSERT ... ON CONFLICT" conflicts, or
multi-master replication row conflicts. They are only relevant on standby
servers.

Metrics in this section are reset when a postgres stats reset is issued
on the db server.

Only defined on standby servers.

Derived from the `pg_stat_database_conflicts` view.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_stat_database_conflicts_confl_tablespace` | COUNTER | Number of queries in this database that have been canceled due to dropped tablespaces |
| `cnp_pg_stat_database_conflicts_confl_lock` | COUNTER | Number of queries in this database that have been canceled due to lock timeouts |
| `cnp_pg_stat_database_conflicts_confl_snapshot` | COUNTER | Number of queries in this database that have been canceled due to old snapshots |
| `cnp_pg_stat_database_conflicts_confl_bufferpin` | COUNTER | Number of queries in this database that have been canceled due to pinned buffers |
| `cnp_pg_stat_database_conflicts_confl_deadlock` | COUNTER | Number of queries in this database that have been canceled due to deadlocks |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `datname` | Name of the database |

#### Group `cnp_pg_stat_user_tables`

Access and usage statistics maintained by postgres on non-system tables.

Metrics in this section are reset when a postgres stats reset is issued
on the db server.

Derived from the `pg_stat_user_tables` view.

See also `cnp_pg_statio_user_tables`.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_stat_user_tables_seq_scan` | COUNTER | Number of sequential scans initiated on this table |
| `cnp_pg_stat_user_tables_seq_tup_read` | COUNTER | Number of live rows fetched by sequential scans |
| `cnp_pg_stat_user_tables_idx_scan` | COUNTER | Number of index scans initiated on this table |
| `cnp_pg_stat_user_tables_idx_tup_fetch` | COUNTER | Number of live rows fetched by index scans |
| `cnp_pg_stat_user_tables_n_tup_ins` | COUNTER | Number of rows inserted |
| `cnp_pg_stat_user_tables_n_tup_upd` | COUNTER | Number of rows updated |
| `cnp_pg_stat_user_tables_n_tup_del` | COUNTER | Number of rows deleted |
| `cnp_pg_stat_user_tables_n_tup_hot_upd` | COUNTER | Number of rows HOT updated (i.e., with no separate index update required) |
| `cnp_pg_stat_user_tables_n_live_tup` | GAUGE | Estimated number of live rows |
| `cnp_pg_stat_user_tables_n_dead_tup` | GAUGE | Estimated number of dead rows |
| `cnp_pg_stat_user_tables_n_mod_since_analyze` | GAUGE | Estimated number of rows changed since last analyze |
| `cnp_pg_stat_user_tables_last_vacuum` | GAUGE | Last time at which this table was manually vacuumed (not counting VACUUM FULL) |
| `cnp_pg_stat_user_tables_last_autovacuum` | GAUGE | Last time at which this table was vacuumed by the autovacuum daemon |
| `cnp_pg_stat_user_tables_last_analyze` | GAUGE | Last time at which this table was manually analyzed |
| `cnp_pg_stat_user_tables_last_autoanalyze` | GAUGE | Last time at which this table was analyzed by the autovacuum daemon |
| `cnp_pg_stat_user_tables_vacuum_count` | COUNTER | Number of times this table has been manually vacuumed (not counting VACUUM FULL) |
| `cnp_pg_stat_user_tables_autovacuum_count` | COUNTER | Number of times this table has been vacuumed by the autovacuum daemon |
| `cnp_pg_stat_user_tables_analyze_count` | COUNTER | Number of times this table has been manually analyzed |
| `cnp_pg_stat_user_tables_autoanalyze_count` | COUNTER | Number of times this table has been analyzed by the autovacuum daemon |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `datname` | Name of current database |
| `schemaname` | Name of the schema that this table is in |
| `relname` | Name of this table |

#### Group `cnp_pg_stat_replication`

Realtime information about replication connections to this postgres instance,
their progress and activity.

Metrics in this section are not reset when a postgres stats reset is issued
on the db server. The "stat" in the name is a historic artefact from postgres
development.

Derived from the `pg_stat_replication` view.

See also `cnp_pg_replication_slots`, `cnp_pg_replication`.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_stat_replication_backend_start_age` | GAUGE | How long ago in seconds this process was started |
| `cnp_pg_stat_replication_backend_xmin_age` | COUNTER | The age of this standby's xmin horizon |
| `cnp_pg_stat_replication_sent_diff_bytes` | GAUGE | Difference in bytes from the last write-ahead log location sent on this connection |
| `cnp_pg_stat_replication_write_diff_bytes` | GAUGE | Difference in bytes from the last write-ahead log location written to disk by this standby server |
| `cnp_pg_stat_replication_flush_diff_bytes` | GAUGE | Difference in bytes from the last write-ahead log location flushed to disk by this standby server |
| `cnp_pg_stat_replication_replay_diff_bytes` | GAUGE | Difference in bytes from the last write-ahead log location replayed into the database on this standby server |
| `cnp_pg_stat_replication_write_lag_seconds` | GAUGE | Time elapsed between flushing recent WAL locally and receiving notification that this standby server has written it |
| `cnp_pg_stat_replication_flush_lag_seconds` | GAUGE | Time elapsed between flushing recent WAL locally and receiving notification that this standby server has written and flushed it |
| `cnp_pg_stat_replication_replay_lag_seconds` | GAUGE | Time elapsed between flushing recent WAL locally and receiving notification that this standby server has written, flushed and applied it |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `usename` | Name of the replication user |
| `application_name` | Name of the application |

#### Group `cnp_pg_statio_user_tables`

I/O activity statistics maintained by postgres on non-system tables.

Metrics in this section are reset when a postgres stats reset is issued
on the db server.

Derived from the `pg_statio_user_tables` view.

See also `cnp_pg_stat_user_tables`.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_statio_user_tables_heap_blks_read` | COUNTER | Number of disk blocks read from this table |
| `cnp_pg_statio_user_tables_heap_blks_hit` | COUNTER | Number of buffer hits in this table |
| `cnp_pg_statio_user_tables_idx_blks_read` | COUNTER | Number of disk blocks read from all indexes on this table |
| `cnp_pg_statio_user_tables_idx_blks_hit` | COUNTER | Number of buffer hits in all indexes on this table |
| `cnp_pg_statio_user_tables_toast_blks_read` | COUNTER | Number of disk blocks read from this table's TOAST table (if any) |
| `cnp_pg_statio_user_tables_toast_blks_hit` | COUNTER | Number of buffer hits in this table's TOAST table (if any) |
| `cnp_pg_statio_user_tables_tidx_blks_read` | COUNTER | Number of disk blocks read from this table's TOAST table indexes (if any) |
| `cnp_pg_statio_user_tables_tidx_blks_hit` | COUNTER | Number of buffer hits in this table's TOAST table indexes (if any) |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `datname` | Name of current database |
| `schemaname` | Name of the schema that this table is in |
| `relname` | Name of this table |

#### Group `cnp_pg_settings`

Expose the subset of postgres server settings that can be represented as
Prometheus compatible metrics - any integer, boolean or real number.
Text-format settings, list-valued settings and enumeration-typed settings are
not captured or reported.

This set of metrics does not expose per-database settings assigned with
`ALTER DATABASE ... SET ...`, per-user settings assigned with `ALTER USER ...
SET ...`, or per-session values. It only shows the database-system-wide
global values. You can explore other settings interactively using postgres
system views.

Derived from the `pg_settings` view.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_pg_settings_setting` | GAUGE | Setting value. Note that settings are only reported when they were changed via Cloud Native PostgreSQL. |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `name` | Name of the setting |

#### Group `cnp_xlog_insert`

Reports the postgres instance's transaction log insert position in bytes.
Useful to compare one postgres instance's WAL insert position with other
instances' replication replay positions in monitoring.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_xlog_insert_lsn` | GAUGE | Node xlog insert position (lsn) |

#### Group `cnp_bdr_raft_mon`

Expose the raft status per CNP node of a BDR cluster

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_bdr_raft_mon_raftstatus` | GAUGE | Raft health status; 0 for unhealthy, 1 for healthy |

#### Group `cnp_bdr_rep_slot_stats`

Metrics from pg_catalog.pg_stat_replication_slots for each BDR replication slot.
These metrics can be used to monitor logical decoding activity and performance the
sending (upstream) side of a logical replication connection.
See https://www.postgresql.org/docs/current/monitoring-stats.html#MONITORING-PG-STAT-REPLICATION-SLOTS-VIEW
for details.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_bdr_rep_slot_stats_spill_txns` | COUNTER | spill\_txns |
| `cnp_bdr_rep_slot_stats_spill_count` | COUNTER | spill\_count |
| `cnp_bdr_rep_slot_stats_spill_bytes` | COUNTER | spill\_bytes |
| `cnp_bdr_rep_slot_stats_stream_txns` | COUNTER | stream\_txns |
| `cnp_bdr_rep_slot_stats_stream_count` | COUNTER | stream\_count |
| `cnp_bdr_rep_slot_stats_stream_bytes` | COUNTER | stream\_bytes |
| `cnp_bdr_rep_slot_stats_total_txns` | COUNTER | total\_txns |
| `cnp_bdr_rep_slot_stats_total_bytes` | COUNTER | total\_bytes |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `peer_name` | peer\_name |
| `slot_name` | slot\_name |

#### Group `cnp_bdr_rep_lag`

Metrics based on the bdr.node_replication_rates monitoring catalog for monitoring
BDR replication performance and repliation lag. See
https://www.enterprisedb.com/docs/pgd/latest/monitoring/#monitoring-outgoing-replication
and https://www.enterprisedb.com/docs/pgd/latest/bdr/catalogs/#bdrnode_replication_rates

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_bdr_rep_lag_replay_lag_s` | GAUGE | replay\_lag\_s |
| `cnp_bdr_rep_lag_replay_lag_bytes` | GAUGE | replay\_lag\_bytes |
| `cnp_bdr_rep_lag_apply_rate` | GAUGE | apply\_rate |
| `cnp_bdr_rep_lag_catchup_interval_s` | GAUGE | catchup\_interval\_s |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `peer_name` | peer\_name |

#### Group `cnp_bdr_node_slots`

Metrics derived from the bdr.node_slots view. These metrics provide lower level insight
into the progress of outbound BDR replication, including transaction ID limits and
WAL retention and the connection status of replication sessions.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_bdr_node_slots_active_pid` | GAUGE | active\_pid |
| `cnp_bdr_node_slots_xmin_age` | GAUGE | xmin age |
| `cnp_bdr_node_slots_catalog_xmin_age` | GAUGE | catalog\_xmin age |
| `cnp_bdr_node_slots_restart_lsn_age` | GAUGE | restart\_lsn age |
| `cnp_bdr_node_slots_confirmed_flush_lsn_age` | GAUGE | confirmed\_flush\_lsn age |
| `cnp_bdr_node_slots_flush_lag_bytes` | GAUGE | flush\_lag in bytes |
| `cnp_bdr_node_slots_replay_lag_bytes` | GAUGE | replay\_lag in bytes |
| `cnp_bdr_node_slots_slot_state` | GAUGE | slot\_state enumeration. disconnected = 0, streaming = 1, catchup = 2, unknown/unrecognised -1 |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `peer_name` | peer\_name |
| `slot_name` | slot\_name |

#### Group `cnp_bdr_global_locking`

metrics for bdr global lock acquire and hold durations for both DDL and DML lock types.
Useful for detection of long global lock waits or frequent global locks that may impact performance.
These metrics are not fine grained and do not expose information about individual tables, etc.
Details are available in the bdr.global_locks view.

##### Metrics

| Metric   | Usage | Description |
|----------|-------|-------------|
| `cnp_bdr_global_locking_since_locally_requested_s` | GAUGE | since\_locally\_requested\_s |
| `cnp_bdr_global_locking_since_local_granted_s` | GAUGE | since\_local\_granted\_s |


##### Labels

The above metrics may have these labels, represented
as dimensions in Azure Monitor:

| Label | Description |
|-------|-------------|
| `lock_type` | lock\_type |
