---
title: Connecting from Azure
redirects:
 - /biganimal/release/using_cluster/connecting_your_cluster/01_connecting_from_azure
 - /biganimal/release/using_cluster/02_connecting_your_cluster/01_connecting_from_azure/01_private_endpoint
---

Three different methods enable you to connect to your cluster from your application's virtual network in Azure. Each method offers different levels of accessibility and security. We recommend the Azure Private Endpoint method and it is the most commonly used.

## Azure Private Endpoint (recommended)

While other methods for connecting your cluster from your application's virtual network in Azure are available, we strongly recommend using the Azure Private Endpoint method.

 Azure Private Endpoint is a network interface that securely connects a private IP
address from your Azure Virtual Network (VNet) to an external service. You grant access only to a single cluster instead of the entire BigAnimal resource virtual network, thus ensuring maximum network isolation. Other advantages include:
-   You need to configure the Private Link only once. Then you can use multiple Private Endpoints to connect applications from many different VNets.
-   There's no risk of IP address conflicts.

Private Endpoints are the same mechanism used by first-party Azure services such as CosmosDB for private VNet connectivity. For more information, see [What is an Azure Private Endpoint?](https://docs.microsoft.com/en-us/azure/private-link/private-endpoint-overview). Private Links (required by Private Endpoints) are not free, however. See [Azure Private Link pricing](https://azure.microsoft.com/en-us/pricing/details/private-link/#pricing) for information on the costs associated with Private Links (required by Private Endpoints).

!!!note
If you setup a private endpoint and want to change to a public network, you must remove the private endpoint resources before making the change.
!!!


## Private Endpoint example

This example shows how to connect your cluster using Azure Private Endpoint.

Assume that your cluster is on a subscription called `development` and is being accessed from a Linux client VM on another subscription called `test` with the following properties:

-   Cluster:
    -   Subscription: `development`
    -   Cluster ID: `p-mckwlbakq5`
    -   Account ID: `brcxzr08qr7rbei1`
    -   Project ID: `brcxzr08qr7rbei1`
    -   Region: `Japan East`
    -   Organization's domain name: `biganimal.io`


-   Linux client VM called `vm-client`:
    -   Subscription: `test`
    -   Resource group: `rg-client`
    -   Virtual network: `vnet-client`
    -   Virtual network subnet: `snet-client`


#### Prerequisites

To walk through an example in your own environment, you need:

-   Your cluster URL. You can find the URL in the **Connect** tab of your cluster instance in the BigAnimal portal.
-   The IP address of your cluster. You can find the IP address of your cluster using the following command:

    ```shell
    dig +short p-mckwlbakq5.brcxzr08qr7rbei1.biganimal.io
    __OUTPUT__
    10.240.1.218
    ```
-   A Postgres client, such as [psql](https://www.postgresql.org/download/), installed on your client VM.

#### Step 1: BigAnimal automatically provision an Azure Private Link Service for every private Postgres cluster

  You can easily find this managed Private Link Service by looking for the one that have the Cluster ID into its name, like `p-mckwlbakq5-rw-internal-lb`.

#### Step 2: Create an Azure Private Endpoint in each client virtual network

  In this example, you create an Azure Private Endpoint in your client VM's virtual network. After you create the private endpoint, you can use its private IP address to access the cluster. You must perform this procedure for every virtual network you want to connect from.

  You can create the Private Endpoint either using the Azure portal or the Azure CLI. Follow the steps from 1 to 9 for the Azure portal walkthrough, or the steps from 10 to 11 for the Azure CLI walkthrough.

1.  If you prefer to create the Private Endpoint using the Azure portal, on the upper-left side of the screen select **Create a resource > Networking > Private Link**, or in the search box enter *Private Link*.

2.  Select **Create**.

3.  In Private Link Center, select **Private endpoints** in the menu on the left.

4.  In Private endpoints, select **Add**.

5.  Enter the details for the private endpoint as shown in the following image. Use a unique name for the private endpoint.

    For example, enter `vnet-client-private-pg-service`, where `vnet-client` is the client VNet ID.

    !!! Note
        In a later step, you need the private endpoint's name to get its private IP address.

    ![](../images/image12.png)

6.  Connect the private endpoint to the private link service that you created by entering the following details:

    -   Subscription, you need to select the subscription in which BigAnimal created the Postgres cluster, here this would have been `development`.

    -   Resource Type, you need to select `Microsoft.Network/privateLinkServices`.

    -   Resource, you need to select the Private Link Service whose name starts with the Cluster ID, like `p-mckwlbakq5-rw-internal-lb`.

    !!! Note
        The Private Link Service exists is created in a resource group managed by Azure Kubernetes Service in the corresponding Project / Region. Its name follows this pattern: `MC_dp-PROJECT_ID-REGION-counter_REGION`. In this case it would be `MC_dp-brcxzr08qr7rbei1-japaneast-1_japaneast`.

7.  In the **Virtual Network** page, enter the client VM's Virtual Network `vnet-client`.

8.  You can either skip or configure both **DNS** and **Tags** as you need and then go to **Review + Create**.

9.  Select **Create**.

10. If you prefer to create the Private Endpoint using the Azure CLI, either use your local terminal with an Azure CLI profile already configured or open a new Azure Cloud Shell using the Azure portal.

11. Use the following Azure CLI command to create the Private Endpoint by setting these parameters:

    ```shell
    az network private-endpoint create \
        --connection-name p-mckwlbakq5-rw-internal-lb \
        --name vnet-client-private-pg-service \
        --private-connection-resource-id "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/mc_dp-brcxzr08qr7rbei1-japaneast-1_japaneast/providers/Microsoft.Network/privateLinkServices/p-mckwlbakq5-rw-internal-lb" \
        --resource-group rg-client \
        --subnet snet-client \
        --vnet-name vnet-client \
        --subscription test
    ```

    -   `connection-name` needs to be the Private Link Service name, like `p-mckwlbakq5-rw-internal-lb`.

    -   `name` will be the Private Endpoint name, like `vnet-client-private-pg-service`.

    -   `private-connection-resource-id` is the Azure Resource Manager path of the Private Link Service.

    -   `resource-group` is the Resource Group in which the Private Endpoint will be created.

    -   `subnet` is the Azure VNet subnet in which the Private Endpoint will be created.

    -   `vnet-name` is the Azure VNet name in which the Private Endpoint will be created.

    -   `subscription` is the Azure subscription in which the Private Endpoint will be created.

12. You have successfully built a tunnel between your client VM's virtual network and the cluster. You can now access the cluster from the private endpoint in your client VM. The private endpoint's private IP address is associated with an independent virtual network NIC. Get the private endpoint's private IP address using the following commands:

    ```shell
    NICID=$(az network private-endpoint show -n vnet-client-private-pg-service -g rg-client --query "networkInterfaces[0].id" -o tsv)
    az network nic show -n ${NICID##*/} -g rg-client --query "ipConfigurations[0].privateIpAddress" -o tsv
    __OUTPUT__
    100.64.111.5
    ```

13. From the client VM `vm-client`, access the cluster by using the private IP address:

    ```shell
    psql -h 100.64.111.5 -U edb_admin
    __OUTPUT__
    Password for user edb_admin :

    psql (13.4 (Ubuntu 13.4-1.pgdg20.04+1), server 13.4.8 (Debian 13.4.8-1+deb10))
    WARNING : psql major version 13, server major version 13. Some psql features might not work.
    SSL connection (protocol : TLSV1.3, cipher : TLS_AES_256_GCM_SHA384, bits : 256, compression : off) Type "help" for help.

    edb_admin=>

    ```

#### Step 3: Create an Azure Private DNS Zone for the private endpoint

EDB strongly recommends using an [Azure Private DNS Zone](https://docs.microsoft.com/en-us/azure/dns/private-dns-privatednszone) with the private endpoint to establish a connection with a cluster. You can't validate TLS certificates using `verify-full` when connecting to an IP address.

With a Private DNS Zone, you configure a DNS entry for your cluster's public hostname, and Azure DNS ensures that all requests to that domain name from your VNet resolve to the private endpoint's IP address instead of the cluster's IP address.

!!! Note
     You need to create a single Azure Private DNS Zone for each VNet, even if you are connecting to multiple clusters. If you've already created a DNS Zone for this VNet, you can skip to step 6.

1.  In the Azure portal search for *Private DNS Zones*.

2.  Select **Private DNS zone**.

3.  Select **Create private DNS zone**.

4.  Create a private DNS zone using your organization's domain name as an apex domain. The organization's domain name must be unique to your BigAnimal organization. For example, use `biganimal.io`.

    ![](../images/image6.png)

5.  Select the **Virtual network** link on the **Private DNS Zone** page of `brcxzr08qr7rbei1.biganimal.io` and link the private DNS Zone to the client VM's virtual network
    `vnet-client`.

     ![](../images/image10.png)

6.  Add a record for the private endpoint. The address is a private IP addressâ€”the one created with the private endpoint in the previous step.

7.  You can now access your cluster with this private domain name.

    ```shell
    dig +short p-mckwlbakq5.brcxzr08qr7rbei1.biganimal.io
    psql -h p-mckwlbakq5.brcxzr08qr7rbei1.biganimal.io -U edb_admin
    __OUTPUT__
    10.240.1.123
    Password for user edb_admin:

    psql (13.4 (Ubuntu 13.4-1.pgdg28.84+1), server 13.4.8 (Debian 13.4.8-1+deb10))
    WARNING : psql major version 13, server major version 13. Some psql features might not work.
    SSL connection (protocol : TLSV1.3cipherTLS_AES_256_GCM_SHA384, bits : 256, compression : off) Type "help" for help.

    edb_admin=>

    ```

    !!! Tip
        You might need to flush your local DNS cache to resolve your domain name to the new private IP address after adding the private endpoint. For example, on Ubuntu, run the following command:

        ```shell
        sudo systemd-resolve --flush-caches
        ```
## Other methods

-   [Virtual network peering](02_virtual_network_peering)
-   [Azure VNet-VNet connection](02_virtual_network_peering)
