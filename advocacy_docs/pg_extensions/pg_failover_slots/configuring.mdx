---
title: Configuring PG Failover Slots
navTitle: Configuring
---

The extension  must be added to shared_preload_libraries on both the primary instance as well as any standby that is used for high availability (failover or switchover) purposes.

The behavior of PG Failover Slots is configurable using the following configuration options (set in postgresql.conf). The configuration options are prefixed with `pg_failover_slots.`. For example, `pg_failover_slots.synchronize_slot_names`.

## synchronize_slot_names
This configuration option allows the setting of which logical slots should be synchronized to this physical standby. 

Slots to be synchronized are selected by using a slot filter. These slot filters can match a specifically named slot, slots with names matching an SQL LIKE expression or the name of a plugin that a slot is using. Slot filters are defined as `key:value` pair where the key can be one of:

* `name` &mdash; Match an exact slot name, e.g. `name:my_slot`
* `name_like` &mdash; Match any slot name that matches an SQL LIKE expressions, e.g. `name_like:change_%`
* `plugin` &mdash; Match any slot using a named plugin, e.g. `plugin:test_decoding`

Where no key is specified, the system defaults to interpreting it as a `name`. So `my_slot` is equivelant to `name:my_slot`.

Slot filters can be combined in a comma separated string value. Setting `my_slot,name_like:change_%,plugin:test_decoding` would synchronize the slot named `my_slot`, any slot where its name began with `change_` and any slot that used the `test_decoding` plugin.

If `pg_failover_slots.synchronize_slot_names` is set to an empty string, no slots will be synchronized.

The default value for `pg_failover_slots.synchronize_slot_names` is `name_like:%` which matches all logical replication slots and  synchronizes all slots.

## drop_extra_slots
Controls what happens to extra slots on the standby that are not found on the primary using the `pg_failover_slots.synchronize_slot_names` filter. If it's set to `true` (which is the default), they are dropped. Otherwise, they are kept.

## primary_dsn
Specifies the connection string to use to connect to the primary when fetching slot information.

If empty (the default), then use the same connection string as `primary_conninfo`.

!!!Note 
   You can't use `primary_conninfo` if there is a password field in the connection string because it gets obfuscated by PostgreSQL and EDN Failover Slots can't actually see the password. In this case, `pg_failover_slots.primary_dsn` must be configured.

## standby_slot_names
Ensures that the failover-candidate streaming physical replica(s) have received and flushed all changes before they ever become visible to any subscribers. This guarantees that a commit can't vanish on failover to a standby for the consumer of a logical slot.

Replication slots whose names are listed in the comma-separated `pg_failover_slots.standby_slot_names` list are treated specially by the walsender on the primary.

Logical replication walsenders ensure that all local changes are sent and flushed to the replication slots in `pg_failover_slots.standby_slot_names` before the walsender sends those changes for the logical replication slots. Effectively, it provides a synchronous replication barrier between the named list of slots and all the consumers of logically decoded streams from walsender.

Any replication slot may be listed in `pg_failover_slots.standby_slot_names`. Both logical and physical slots work, but it's generally used for physical slots.

Without this safeguard, two anomalies are possible where a commit can be received by a subscriber and then vanish from the provider on failover because the failover candidate hadn't received it yet:

- For one or more subscribers, the subscriber may have applied the change but the new provider may execute new transactions that conflict with the received change, as it never happened as far as the provider is concerned;

- for two or more subscribers, at the time of failover, not all subscribers have applied the change. The subscribers now have inconsistent and irreconcilable states because the subscribers that didn't receive the commit have no way to get it now.
Setting `pg_failover_slots.standby_slot_names` causes subscribers to lag behind the provider if the provider's failover-candidate replica(s) are not keeping up, by design. Monitoring is thus essential.

## standby_slots_min_confirmed
Controls how many of the `pg_failover_slots.standby_slot_names` have to confirm before we send data through the logical replication slots. Setting `-1` (the default) specifies to wait for all entries in `pg_failover_slots.standby_slot_names`.
