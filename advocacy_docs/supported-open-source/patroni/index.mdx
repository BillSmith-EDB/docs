---
title: 'Patroni'
description: 'Introduction to Patroni, a template to create your own high-availability solution'
tags:
  - topology
  - Patroni
indexCards: none
directoryDefaults:
  iconName: 'PostgresSupport'
  product: 'Patroni'
navigation:
- "#Getting started"
- rhel8_quick_start
- debian11_quick_start
- "#Installing"
- installing_patroni
- installing_etcd
- "#Using"
- cluster_management
- tips
---

Patroni is among the most popular open-source tools for managing replication and failover of Postgres clusters. It relies on Postgres's streaming replication and hot standby capabilities. These capabilities allow DBAs to simplify the process of setting up and managing clusters having high availability as well as read scalability requirements. Patroni is tested by EDB for use with PostgreSQL, EDB Postgres Advanced Server and EDB Postgres Extended Server.

!!! Note
    Looking for Patroni documentation? Head over to [https://patroni.readthedocs.io](https://patroni.readthedocs.io/en/latest/)


## Supported topology

Main High Availability components:
* Postgres cluster: the database cluster, usually consisting of a primary and two or more replicas
* Patroni: used as the failover management utility
* etcd: used as a distributed configuration store (DCS), containing cluster information such as configuration, health, and current status
* HAProxy: used as a proxy to connect to the read-write and read-only nodes

![Supported topology](images/supported-arch.png)

### Postgres

We currently support using Patroni and Postgres _physical_ streaming replication with a primary server and two replicas (replicating directly from the primary). We support using either PostgreSQL, EDB Postgres Advanced Server or EDB Postgres Extended Server.

### Patroni

Install Patroni on the Postgres nodes. We support the [latest release](https://patroni.readthedocs.io/en/latest/releases.html#releases) of Patroni.

### Etcd

Etcd is a strongly consistent, distributed key-value store. It provides a reliable way to store data that a distributed system or cluster of machines needs to access.

For more information, see the [etcd documentation](https://etcd.io/docs/).

!!! Note
    For production environments, we recommend setting up an etcd cluster of three nodes. One etcd cluster can serve multiple Postgres/Patroni clusters. Intall etcd nodes on different hosts from the Postgres nodes.

See the [Installing and configuring etcd](installing_etcd) to install and set up etcd.

### Watchdog

To avoid split-brain situations, Patroni supports [watchdog](https://patroni.readthedocs.io/en/latest/watchdog.html) devices.

> Watchdog devices are software or hardware mechanisms that will reset the whole system when they don't get a keepalive heartbeat within a specified timeframe. This adds an additional layer of fail safe in case usual Patroni split-brain protection mechanisms fail.

!!! Note
    While the use of a watchdog mechanism with Patroni is optional, we recommend using it for production environments.


### HAProxy

Instead of connecting directly to the database server, you can set up HAProxy so the application connects to the proxy instead. The proxy then forwards the request to Postgres. When you use HAProxy for this purpose, you can route read-only requests to one or more replicas for load balancing

We strongly suggest using HAProxy to avoid data loss in case of a split-brain.

You can install HAProxy as an independent server, but you can also install it on the application server or the database server.

!!! Note
    For production environments, we recommend setting up at least two HAProxy servers. Using various ports, one HAProxy server can serve multiple Postgres/Patroni clusters.


## Security considerations

Security considerations are beyond the scope of this documentation. You can find more details about the distributed configuration storage (DCS) and the Patroni REST API can be found in the [Patroni documentation](https://patroni.readthedocs.io/en/latest/security.html).

You can use HTTPS with HAProxy, which is not covered in this documentation.
